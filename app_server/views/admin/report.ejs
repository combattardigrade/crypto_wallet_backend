<%- include('header'); -%>

<div class="page-wrapper">
    <div class="page-content">
        <nav class="page-breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Reporte</a></li>
                <li class="breadcrumb-item active" aria-current="page">ID <%= report.id %></li>
            </ol>
        </nav>
        <div class="row">
            <div class="col-md-4 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title">Datos del Reporte </h6>

                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Campo</th>
                                        <th>Valor</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="font-weight: bold;">ID: </td>
                                        <td><%= report.id %></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">Título: </td>
                                        <td><%= report.title %></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">Descripción: </td>
                                        <td><%= report.description %></td>
                                    </tr>                                    
                                    <tr>
                                        <td style="font-weight: bold;">Geolocalización: </td>
                                        <td><%= report.lat %>, <%= report.lng %></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">Fecha de creación: </td>
                                        <td><%= report.createdAt  %></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">Guardia (ID): </td>
                                        <td><%= report.user.id  %></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">Guardia (Usuario): </td>
                                        <td><%= report.user.username  %></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">Guardia (Nombre): </td>
                                        <td><%= report.user.name  %></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title">Mapa</h6>
                        <div id="map" style="width: 100%; height: 80%; min-height: 400px;"></div>
                    </div>
                </div>
            </div>

        </div>
        
        <div class="row">
            <div class="col-md-4 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title">Fotografías</h6>
                        <a href="<%= host%>api/photo/<%= report.photoId %>"><img style="width:auto;height: 400px;border-radius: 5px;" src="<%= host %>api/photo/<%= report.photoId %>" /></a>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<script src="<%= host %>assets/bundle.js"></script>
<script>
    function initMap() {
        const location = { lat: parseFloat(`<%= report.lat %>`), lng: parseFloat(`<%= report.lng %>`) }
        const report = JSON.parse(`<%- JSON.stringify(report) %>`);

        App.map = new google.maps.Map(document.getElementById('map'), {
            center: location,
            zoom: 15,
            styles: [{
                featureType: 'poi',
                elementType: 'labels.icon',
                stylers: [{ visibility: 'off' }] // hide poi (businesses) icons
            },
            {
                featureType: 'poi',
                elementType: 'geometry',
                stylers: [{ color: '#e5e5e5' }] // poi geometry color
            },
            {
                featureType: 'poi.park',
                elementType: 'labels.text.stroke',
                stylers: [{ color: '#ffffff' }] // hide local businesses labels
            },
            {
                featureType: 'poi.park',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#676767' }] // hide local businesses labels
            },
            {
                featureType: 'landscape',
                elementType: 'geometry',
                stylers: [{ color: '#f5f5f5' }] // buildings and so on
            },
            {
                featureType: 'road.arterial',
                elementType: 'labels',
                stylers: [{ visibility: 'off' }] // hide arterial roads labels
            },
            {
                featureType: 'road.highway',
                elementType: 'geometry', // highway color
                stylers: [{ color: '#dadada' }]
            },
            {
                featureType: 'road.highway',
                elementType: 'labels.text.stroke', // highway label text stroke (contorno)
                stylers: [{ color: '#ffffff' }]
            },
            {
                featureType: 'road',
                elementType: 'labels.text.fill', // rad label text color (fill)
                stylers: [{ color: '#676767' }]
            },
            {
                featureType: 'road.local',
                elementType: 'geometry',
                stylers: [{ color: '#ffffff' }] // park roads color

            },
            {
                featureType: 'transit',
                elementType: 'labels.icon',
                stylers: [{ visibility: 'off' }]
            },
            {
                featureType: 'transit',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#676767' }]
            },
            {
                featureType: 'transit',
                elementType: 'labels.text.stroke',
                stylers: [{ color: '#ffffff' }]
            },
            {
                featureType: 'transit.station.bus',
                elementType: 'labels.icon',
                stylers: [{ visibility: 'off' }]
            }]

        });

        let marker = new google.maps.Marker({
            position: location,
            map: App.map,   
        })      

        const infowindow = new google.maps.InfoWindow({
            content: `<div>Título: <span>${report.title}</span></div><div>Descripción: <span>${report.description}</span></div>`
        });

        marker.addListener('click', function () {
            infowindow.open(App.map, marker);
        })
    }
</script>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAY5scI2sYPDGoLn2INfct1gMw5gFLIHjs&callback=initMap"></script>

<%- include('footer'); -%>